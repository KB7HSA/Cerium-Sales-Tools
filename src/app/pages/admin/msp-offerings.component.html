<div class="space-y-8">
  <!-- Header -->
  <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white">MSP Offerings</h1>
      <p class="mt-2 text-gray-600 dark:text-gray-400">Manage your service offerings, pricing, and options</p>
    </div>
    <a
      routerLink="/admin/create-offering"
      class="inline-flex items-center gap-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 transition-colors"
    >
      <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
      Create Offering
    </a>
  </div>

  <!-- Stats -->
  <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
    <div class="rounded-lg bg-white dark:bg-gray-800 p-6 shadow">
      <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Total Offerings</p>
      <p class="mt-2 text-3xl font-bold text-gray-900 dark:text-white">{{ getTotalServices() }}</p>
    </div>
    <div class="rounded-lg bg-white dark:bg-gray-800 p-6 shadow">
      <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Active</p>
      <p class="mt-2 text-3xl font-bold text-green-600 dark:text-green-400">{{ getActiveServices() }}</p>
    </div>
    <div class="rounded-lg bg-white dark:bg-gray-800 p-6 shadow">
      <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Inactive</p>
      <p class="mt-2 text-3xl font-bold text-red-600 dark:text-red-400">{{ getTotalServices() - getActiveServices() }}</p>
    </div>
  </div>

  <!-- Filters -->
  <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
    <div class="flex flex-wrap gap-2">
      <button
        (click)="setFilter('all')"
        [class.bg-blue-600]="activeFilter === 'all'"
        [class.text-white]="activeFilter === 'all'"
        [class.bg-gray-200]="activeFilter !== 'all'"
        [class.dark:bg-gray-700]="activeFilter !== 'all'"
        [class.text-gray-900]="activeFilter !== 'all'"
        [class.dark:text-gray-300]="activeFilter !== 'all'"
        class="px-4 py-2 rounded-lg font-medium transition-colors"
      >
        All Services
      </button>
      <button
        (click)="setFilter('backup')"
        [class.bg-blue-600]="activeFilter === 'backup'"
        [class.text-white]="activeFilter === 'backup'"
        [class.bg-gray-200]="activeFilter !== 'backup'"
        [class.dark:bg-gray-700]="activeFilter !== 'backup'"
        [class.text-gray-900]="activeFilter !== 'backup'"
        [class.dark:text-gray-300]="activeFilter !== 'backup'"
        class="px-4 py-2 rounded-lg font-medium transition-colors"
      >
        Backup ({{ getServicesByCategory('backup') }})
      </button>
      <button
        (click)="setFilter('support')"
        [class.bg-blue-600]="activeFilter === 'support'"
        [class.text-white]="activeFilter === 'support'"
        [class.bg-gray-200]="activeFilter !== 'support'"
        [class.dark:bg-gray-700]="activeFilter !== 'support'"
        [class.text-gray-900]="activeFilter !== 'support'"
        [class.dark:text-gray-300]="activeFilter !== 'support'"
        class="px-4 py-2 rounded-lg font-medium transition-colors"
      >
        Support ({{ getServicesByCategory('support') }})
      </button>
      <button
        (click)="setFilter('database')"
        [class.bg-blue-600]="activeFilter === 'database'"
        [class.text-white]="activeFilter === 'database'"
        [class.bg-gray-200]="activeFilter !== 'database'"
        [class.dark:bg-gray-700]="activeFilter !== 'database'"
        [class.text-gray-900]="activeFilter !== 'database'"
        [class.dark:text-gray-300]="activeFilter !== 'database'"
        class="px-4 py-2 rounded-lg font-medium transition-colors"
      >
        Database ({{ getServicesByCategory('database') }})
      </button>
      <button
        (click)="setFilter('consulting')"
        [class.bg-blue-600]="activeFilter === 'consulting'"
        [class.text-white]="activeFilter === 'consulting'"
        [class.bg-gray-200]="activeFilter !== 'consulting'"
        [class.dark:bg-gray-700]="activeFilter !== 'consulting'"
        [class.text-gray-900]="activeFilter !== 'consulting'"
        [class.dark:text-gray-300]="activeFilter !== 'consulting'"
        class="px-4 py-2 rounded-lg font-medium transition-colors"
      >
        Consulting ({{ getServicesByCategory('consulting') }})
      </button>
    </div>

    <!-- Search -->
    <div class="flex-1 sm:flex-none">
      <input
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        type="text"
        placeholder="Search offerings..."
        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
      />
    </div>
  </div>

  <!-- Offerings Grid -->
  @if (filteredOfferings.length > 0) {
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
      @for (offering of filteredOfferings; track offering.id) {
        <div
          [routerLink]="['/admin/edit-offering', offering.id]"
          class="group cursor-pointer rounded-lg bg-white dark:bg-gray-800 p-6 shadow hover:shadow-lg transition-all"
        >
          @if (offering.imageUrl) {
            <img
              [src]="offering.imageUrl"
              [alt]="offering.name"
              class="mb-4 h-32 w-full rounded-lg object-cover"
            />
          } @else {
            <div class="mb-4 flex h-32 w-full items-center justify-center rounded-lg border border-dashed border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/40">
              <span class="text-xs text-gray-500 dark:text-gray-400">No image</span>
            </div>
          }
          <!-- Header -->
          <div class="flex items-start justify-between mb-4">
            <div class="flex-1">
              <div class="flex items-center gap-3">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">{{ offering.name }}</h3>
                <span [class]="'inline-block px-3 py-1 rounded-full text-xs font-semibold ' + getCategoryColor(offering.category)">
                  {{ getCategoryLabel(offering.category) }}
                </span>
              </div>
              <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">{{ offering.description }}</p>
            </div>
          </div>

          <!-- Status Badge -->
          <div class="mb-4">
            @if (offering.isActive) {
              <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                Active
              </span>
            } @else {
              <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">
                Inactive
              </span>
            }
          </div>

          <!-- Pricing -->
          <div class="mb-4 grid grid-cols-2 gap-4 py-4 border-y border-gray-200 dark:border-gray-700">
            <div>
              <p class="text-xs font-medium text-gray-600 dark:text-gray-400">Default Level</p>
              <p class="mt-1 text-lg font-bold text-gray-900 dark:text-white">
                @if (getDefaultLevel(offering); as level) {
                  {{ level.name }}
                } @else {
                  --
                }
              </p>
            </div>
            <div>
              <p class="text-xs font-medium text-gray-600 dark:text-gray-400">Setup Fee</p>
              <p class="mt-1 text-lg font-bold text-gray-900 dark:text-white">${{ offering.setupFee }}</p>
            </div>
          </div>

          <div class="mb-4">
            <p class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Service Levels ({{ offering.serviceLevels.length }})</p>
            <div class="space-y-2">
              @for (level of offering.serviceLevels.slice(0, 2); track $index) {
                <div class="p-2 rounded bg-gray-50 dark:bg-gray-700/40 border border-gray-200 dark:border-gray-700">
                  <div class="flex items-center justify-between mb-1">
                    <span class="font-medium text-sm text-gray-900 dark:text-white">{{ level.name }}</span>
                    <span class="text-xs font-semibold text-blue-600 dark:text-blue-400">${{ level.basePrice }}{{ getPricingUnitLabel(level.pricingUnit) }}</span>
                  </div>
                  @if (level.professionalServicesPrice && level.professionalServicesPrice > 0) {
                    <div class="text-xs text-gray-600 dark:text-gray-400">
                      Prof. Services: ${{ level.professionalServicesPrice }}{{ getPricingUnitLabel(level.pricingUnit) }}
                    </div>
                  }
                </div>
              }
              @if (offering.serviceLevels.length > 2) {
                <p class="text-sm text-gray-500 italic">+{{ offering.serviceLevels.length - 2 }} more level(s)</p>
              }
            </div>
          </div>

          <!-- Features -->
          <div class="mb-4">
            <p class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Key Features ({{ offering.features.length }})</p>
            <ul class="space-y-1">
              @for (feature of offering.features.slice(0, 3); track $index) {
                <li class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                  <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-green-600 dark:text-green-400">
                    <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                  {{ feature }}
                </li>
              }
              @if (offering.features.length > 3) {
                <li class="text-sm text-gray-500 italic">+{{ offering.features.length - 3 }} more</li>
              }
            </ul>
          </div>

          <!-- Options -->
          @if (getDefaultLevel(offering); as level) {
            @if (level.options.length > 0) {
              <div class="mb-4">
                <p class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Add-on Options ({{ level.options.length }})</p>
                <div class="space-y-1">
                  @for (option of level.options.slice(0, 2); track $index) {
                    <div class="flex items-center justify-between text-sm">
                      <span class="text-gray-600 dark:text-gray-400">{{ option.name }}</span>
                      <span class="font-semibold text-gray-900 dark:text-white">${{ option.monthlyPrice }}{{ getPricingUnitLabel(option.pricingUnit) }}</span>
                    </div>
                  }
                  @if (level.options.length > 2) {
                    <p class="text-sm text-gray-500 italic">+{{ level.options.length - 2 }} more options</p>
                  }
                </div>
              </div>
            }
          }
          <!-- Actions -->
          <div class="flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700">
            <div class="text-xs text-gray-500 dark:text-gray-400">
              Last modified: {{ offering.lastModified }}
            </div>
            <div class="flex items-center gap-2" (click)="$event.stopPropagation()">
              <button
                (click)="toggleOfferingStatus(getOfferingId(offering), $event)"
                [title]="offering.isActive ? 'Deactivate' : 'Activate'"
                class="p-2 text-gray-500 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
              >
                <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M3 12C3 16.9706 7.02944 21 12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12Z" stroke="currentColor" stroke-width="1.5"></path>
                  <path d="M12 7V12L16 14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>
                </svg>
              </button>
              <button
                (click)="deleteOffering(getOfferingId(offering), $event)"
                title="Delete"
                class="p-2 text-gray-500 hover:text-red-600 dark:hover:text-red-400 transition-colors"
              >
                <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="currentColor"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="rounded-lg bg-white dark:bg-gray-800 p-12 text-center shadow">
      <svg width="4em" height="4em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mx-auto mb-4 text-gray-400 dark:text-gray-600">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 3.5C7.30558 3.5 3.5 7.30558 3.5 12C3.5 16.6944 7.30558 20.5 12 20.5C16.6944 20.5 20.5 16.6944 20.5 12C20.5 7.30558 16.6944 3.5 12 3.5Z" fill="currentColor"></path>
      </svg>
      <p class="text-gray-600 dark:text-gray-400 text-lg font-medium">No offerings found</p>
      <p class="text-gray-500 dark:text-gray-500 text-sm">Try adjusting your search or filter criteria</p>
    </div>
  }
</div>
