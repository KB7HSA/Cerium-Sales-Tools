<div class="space-y-8">
  <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Labor Budget Admin</h1>
      <p class="mt-2 text-gray-600 dark:text-gray-400">Maintain work items and formulas used in the Labor Budget calculator.</p>
    </div>
    <a
      routerLink="/labor-budget"
      class="inline-flex items-center gap-2 rounded-lg border border-gray-300 dark:border-gray-700 px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800"
    >
      View Calculator
    </a>
  </div>

  @if (errorMessage) {
    <div class="rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700 dark:border-red-900 dark:bg-red-900/40 dark:text-red-200">
      {{ errorMessage }}
    </div>
  }

  <div class="rounded-lg bg-white dark:bg-gray-800 p-6 shadow">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Add Work Item</h2>
    <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Work Item Name</label>
        <input
          [(ngModel)]="newItemName"
          type="text"
          class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-gray-900 dark:text-white"
          placeholder="Switch Deployment"
        />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Hours per Switch</label>
        <input
          [(ngModel)]="newItemHours"
          type="number"
          min="0"
          step="0.1"
          class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-gray-900 dark:text-white"
        />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Rate per Hour</label>
        <input
          [(ngModel)]="newItemRate"
          type="number"
          min="0"
          step="0.01"
          class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-gray-900 dark:text-white"
        />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Reference Architecture</label>
        <select
          [(ngModel)]="newItemReferenceArchitecture"
          class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-gray-900 dark:text-white"
        >
          @for (tag of referenceArchitectureTags; track tag) {
            <option [value]="tag">{{ tag }}</option>
          }
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description</label>
        <input
          [(ngModel)]="newItemDescription"
          type="text"
          class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-gray-900 dark:text-white"
          placeholder="Formula reference or notes"
        />
      </div>
    </div>
    <div class="mt-4">
      <button
        type="button"
        (click)="addItem()"
        class="rounded-lg bg-blue-600 px-6 py-2 text-sm font-semibold text-white hover:bg-blue-700"
      >
        Add Item
      </button>
    </div>
  </div>

  <div class="rounded-lg bg-white dark:bg-gray-800 p-6 shadow">
    <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Labor Budget Items</h2>
      <div class="w-full sm:w-64">
        <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">Reference Architecture</label>
        <select
          [(ngModel)]="referenceArchitectureFilter"
          class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-sm text-gray-900 dark:text-white"
        >
          <option value="All">All</option>
          @for (tag of referenceArchitectureTags; track tag) {
            <option [value]="tag">{{ tag }}</option>
          }
        </select>
      </div>
    </div>
    @if (filteredItems.length === 0) {
      <p class="text-sm text-gray-500 dark:text-gray-400">No work items configured.</p>
    } @else {
      <div class="space-y-4">
        @for (item of filteredItems; track item.id) {
          <div class="rounded-lg border border-gray-200 dark:border-gray-700 p-4">
            <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
              <div>
                <p class="text-sm font-semibold text-gray-900 dark:text-white">{{ item.name }}</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">{{ item.referenceArchitecture }} â€¢ {{ item.description || 'No description' }}</p>
              </div>
              <div class="flex items-center gap-2">
                @if (!editingItems[item.id]) {
                  <button
                    type="button"
                    (click)="startEditItem(item)"
                    class="text-sm font-medium text-blue-600 dark:text-blue-400"
                  >
                    Edit
                  </button>
                }
                <button
                  type="button"
                  (click)="deleteItem(item)"
                  class="text-sm font-medium text-red-600 dark:text-red-400"
                >
                  Delete
                </button>
              </div>
            </div>

            @if (editingItems[item.id]) {
              <div class="mt-4 grid grid-cols-1 gap-4 md:grid-cols-2">
                <div>
                  <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">Work Item Name</label>
                  <input
                    [(ngModel)]="itemDrafts[item.id].name"
                    type="text"
                    class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-gray-900 dark:text-white"
                  />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">Hours per Switch</label>
                  <input
                    [(ngModel)]="itemDrafts[item.id].hoursPerSwitch"
                    type="number"
                    min="0"
                    step="0.1"
                    class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-gray-900 dark:text-white"
                  />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">Rate per Hour</label>
                  <input
                    [(ngModel)]="itemDrafts[item.id].ratePerHour"
                    type="number"
                    min="0"
                    step="0.01"
                    class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-gray-900 dark:text-white"
                  />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">Reference Architecture</label>
                  <select
                    [(ngModel)]="itemDrafts[item.id].referenceArchitecture"
                    class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-gray-900 dark:text-white"
                  >
                    @for (tag of referenceArchitectureTags; track tag) {
                      <option [value]="tag">{{ tag }}</option>
                    }
                  </select>
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">Description</label>
                  <input
                    [(ngModel)]="itemDrafts[item.id].description"
                    type="text"
                    class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-gray-900 dark:text-white"
                  />
                </div>
              </div>
              <div class="mt-4 flex items-center gap-2">
                <button
                  type="button"
                  (click)="saveEditItem(item)"
                  class="rounded-lg bg-blue-600 px-4 py-2 text-xs font-semibold text-white hover:bg-blue-700"
                >
                  Save
                </button>
                <button
                  type="button"
                  (click)="cancelEditItem(item)"
                  class="rounded-lg bg-gray-300 px-4 py-2 text-xs font-semibold text-gray-900 hover:bg-gray-400 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600"
                >
                  Cancel
                </button>
              </div>
            } @else {
              <div class="mt-3 text-sm text-gray-600 dark:text-gray-400">
                <span>Hours per switch: {{ item.hoursPerSwitch }}</span>
                <span class="mx-2">|</span>
                <span>Rate: ${{ item.ratePerHour }}/hr</span>
              </div>
            }
          </div>
        }
      </div>
    }
  </div>
</div>
